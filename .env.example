# ============================================
# Keyway Self-Hosting Configuration
# ============================================
# Copy this file to .env and fill in the required values.
# Lines marked [REQUIRED] must be set before starting the stack.
# Lines marked [OPTIONAL] have sensible defaults or can be left empty.

# ============================================
# Domain Configuration [REQUIRED]
# ============================================
# Your root domain. All service URLs are derived from this:
#   Root:          https://<DOMAIN> (redirects to dashboard)
#   Dashboard:     https://app.<DOMAIN>
#   API:           https://api.<DOMAIN>
DOMAIN=example.com

# Override individual URLs if your setup differs from the convention above.
# These default to values derived from DOMAIN if left empty.
# FRONTEND_URL=https://example.com
# DASHBOARD_URL=https://app.example.com
# ALLOWED_ORIGINS=https://example.com,https://app.example.com

# ============================================
# Database [REQUIRED]
# ============================================
# PostgreSQL connection string.
# The default value works with the bundled docker-compose postgres service.
DATABASE_URL=postgresql://keyway:keyway@db:5432/keyway

# ============================================
# Encryption [REQUIRED]
# ============================================
# AES-256-GCM encryption key for secrets at rest.
# Must be a 64-character hexadecimal string (32 bytes).
#
# WARNING: Once secrets are stored, this key CANNOT be changed
# without losing all encrypted data!
#
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=

# Multi-key format for key rotation (optional, overrides ENCRYPTION_KEY):
#   ENCRYPTION_KEYS=1:hex_key_1,2:hex_key_2
# The highest-versioned key is used for new encryptions.
# ENCRYPTION_KEYS=

# ============================================
# Crypto Service [REQUIRED]
# ============================================
# gRPC address for the keyway-crypto encryption microservice.
# The default value works with the bundled docker-compose crypto service.
CRYPTO_SERVICE_URL=crypto:50051

# gRPC listen port inside the crypto container (default: 50051).
# GRPC_PORT=50051

# ============================================
# Authentication [REQUIRED]
# ============================================
# JWT secret for signing auth tokens (min 32 characters).
# Generate with: openssl rand -base64 32
JWT_SECRET=

# ============================================
# GitHub App [REQUIRED]
# ============================================
# Keyway uses a GitHub App for user authentication (OAuth) and
# repository access verification (installation tokens).
#
# Create a GitHub App: https://github.com/settings/apps/new
#
# Required settings:
#   - Homepage URL: https://<DOMAIN>
#   - Callback URL: https://api.<DOMAIN>/v1/auth/callback
#   - Request user authorization during installation: Yes
#   - Enable Device Flow: Yes
#
# Required permissions:
#   - Repository: Metadata (Read-only)
#   - Repository: Administration (Read-only)
#   - Account: Email addresses (Read-only)
#
# Subscribe to events:
#   - Installation
#   - Installation repositories
GITHUB_APP_ID=
GITHUB_APP_CLIENT_ID=
GITHUB_APP_CLIENT_SECRET=
GITHUB_APP_PRIVATE_KEY=          # Base64-encoded PEM key
GITHUB_APP_WEBHOOK_SECRET=       # Recommended in production
GITHUB_APP_NAME=keyway-app       # App slug (used for install URL)

# ============================================
# GitHub Enterprise [OPTIONAL]
# ============================================
# Set these to use GitHub Enterprise Server instead of github.com.
# GITHUB_URL=https://github.example.com
# GITHUB_BASE_URL=https://github.example.com/api/v3

# ============================================
# Optional: Billing (Stripe)
# ============================================
# Set BILLING_ENABLED=false (default) to disable all billing/plan limits.
# Without billing, all users get unlimited access.
BILLING_ENABLED=false
# STRIPE_SECRET_KEY=
# STRIPE_WEBHOOK_SECRET=
# STRIPE_PRICE_PRO_MONTHLY=
# STRIPE_PRICE_PRO_YEARLY=
# STRIPE_PRICE_TEAM_MONTHLY=
# STRIPE_PRICE_TEAM_YEARLY=
# STRIPE_PRICE_STARTUP_MONTHLY=
# STRIPE_PRICE_STARTUP_YEARLY=

# ============================================
# Optional: Email (Resend)
# ============================================
# Without this, welcome and security alert emails will not be sent.
# RESEND_API_KEY=
# EMAIL_FROM_ADDRESS=Keyway <hello@mail.example.com>
# EMAIL_FROM_NAME=hello@example.com

# ============================================
# Optional: Analytics (PostHog)
# ============================================
# Leave empty to disable analytics entirely.
# POSTHOG_API_KEY=
# POSTHOG_HOST=https://app.posthog.com
# NEXT_PUBLIC_POSTHOG_KEY=
# NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# ============================================
# Optional: Error Tracking (Sentry)
# ============================================
# Leave empty to disable error tracking.
# SENTRY_DSN=
# NEXT_PUBLIC_SENTRY_DSN=

# ============================================
# Optional: Live Chat (Crisp)
# ============================================
# Leave empty to disable live chat widget.
# CRISP_WEBSITE_ID=
# NEXT_PUBLIC_CRISP_WEBSITE_ID=

# ============================================
# Optional: IP Geolocation (ipinfo.io)
# ============================================
# Without this, security features like impossible travel detection will not work.
# IPINFO_TOKEN=

# ============================================
# Optional: Provider Integrations
# ============================================
# VERCEL_CLIENT_ID=
# VERCEL_CLIENT_SECRET=
# NETLIFY_CLIENT_ID=
# NETLIFY_CLIENT_SECRET=

# ============================================
# Optional: Rate Limiting
# ============================================
# RATE_LIMIT_MAX=100
# RATE_LIMIT_WINDOW=15 minutes

# ============================================
# Server Configuration
# ============================================
NODE_ENV=production
# PORT=3000
# HOST=0.0.0.0
# LOG_LEVEL=info

# ============================================
# Docker Compose Overrides
# ============================================
# Caddyfile to mount (default: Caddyfile.production for auto-HTTPS).
# For local dev with mkcert, set CADDYFILE=./Caddyfile
# CADDYFILE=./Caddyfile.production

# Path to TLS certificates directory (used by local dev Caddyfile).
# CADDY_CERTS=./certs
